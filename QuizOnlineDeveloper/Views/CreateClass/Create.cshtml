
@{
    ViewBag.Title = "Create";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    button:focus {
        box-shadow: none;
        border: none;
        outline: none !important;
    }

    .toggle {
        background: none;
        border: none;
        color: #337ab7;
        font-weight: 600;
        position: absolute;
        right: 1.5em;
        top: 2.25em;
        z-index: 9;
    }
</style>

<div class="container-fluid" style="padding-bottom: 5rem; background-image: url('https://images.pexels.com/photos/292442/pexels-photo-292442.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=650&w=940')">

    <div class="row">
        <div class="col-lg-8 col-lg-offset-2">
            <div class="wizard-container">
                <div class="card wizard-card" data-color="orange" id="wizardProfile">
                    <form method="post">
                        <div class="wizard-header">
                            <h3>
                                Tạo Khóa Học<br>
                                <small>Học không chơi đánh rơi tuổi trẻ, chơi không học bán rẻ tương lai.</small>
                            </h3>
                        </div>
                        <div class="wizard-navigation">
                            <ul>
                                <li><a href="#about" data-toggle="tab">Thông tin</a></li>
                                <li><a href="#address" data-toggle="tab">Học Sinh</a></li>
                                <li><a href="#EnrolmentKey" data-toggle="tab">Mã Vào Lớp</a></li>
                            </ul>
                        </div>
                        <div class="row">
                            <div class="col-lg-12">
                                @if (TempData["AlertMessage"] != null)
                                {
                                    <div id="AlertBox" class="alert @TempData["AlertType"]">
                                        @TempData["AlertMessage"]
                                        Bạn muốn <a href="/tao-khoa-hoc" class="alert-link">Tiếp tục </a>hay quay về <a href="/khoa-hoc-cua-toi" class="alert-link">Quản lí khóa học</a>
                                    </div>
                                }
                            </div>
                        </div>
                        <div class="tab-content">
                            <div class="tab-pane" id="about">
                                <div class="row">
                                    <h4 class="info-text"> Thông Tin Khóa Học</h4>
                                    <div class="col-lg-6">
                                    </div>
                                    <div class="col-lg-10 col-lg-offset-1">
                                        <div class="form-group">
                                            <label>Tên Khóa Học <small>(bắt buộc)</small></label>
                                            <input name="classname" type="text" class="form-control" id="className" placeholder="Nhập Tên Khóa Học ...">
                                        </div>
                                    </div>
                                    <div class="col-lg-10 col-lg-offset-1">
                                        <div class="form-group">
                                            <label>Mô Tả</label>
                                            <input name="desc" type="text" class="form-control" id="classDes" placeholder="Nhập Mô Tả ...">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane" id="address">
                                <div class="row">
                                    <div class="col-lg-10 col-lg-offset-1">
                                        <div class="form-group">
                                            <label>Học Sinh</label><br>
                                            <div>
                                                <select class="js-example-basic-multiple" multiple="multiple" style="width:100%">
                                                    <option>-- Search --</option>
                                                    <option></option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-12 text-center">
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane" id="EnrolmentKey">
                                <div class="row">
                                    <h4 class="info-text"> Tạo Mã Vào Lớp(Enrolment Key)</h4>
                                    <div class="col-lg-6">
                                    </div>
                                    <div class="col-lg-10 col-lg-offset-1">
                                        <div class="form-group">
                                            <label>Mã vào lớp <small>(bắt buộc)</small></label>
                                            <input type="password" id="enrolmentkey" class="form-control" name="enrolmentkey" placeholder="Nhập Mã Vào Lớp ..." />
                                            <button type="button" id="btnToggle" class="toggle"><i id="eyeIcon" class="fa fa-eye"></i></button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="wizard-footer height-wizard">
                            <div class="pull-right">
                                <input type='button' class='btn btn-next btn-fill btn-warning btn-wd btn-sm' name='next' value='Tiếp theo' />
                                <input type='submit' class='btn btn-finish btn-fill btn-warning btn-wd btn-sm' id='btn-tao1' name='finish' value='Kết thúc' />
                            </div>
                            <div class="pull-left">
                                <input type='button' class='btn btn-previous btn-fill btn-default btn-wd btn-sm' name='previous' value='Quay lại' />
                            </div>
                            <div class="clearfix"></div>
                        </div>
                    </form>
                </div>
            </div> <!-- wizard container -->
        </div>
    </div><!-- end row -->
</div> <!--  big container -->

@section jsFooter{

    <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
    @*<link href="~/Asserts/Client/css/bootstrap.min.css" rel="stylesheet" />*@
    <link href="~/Asserts/Client/css/CreateClass.css" rel="stylesheet" />
    @*<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>*@
    <script src="~/Asserts/Client/js/jquery-2.2.4.min.js" type="text/javascript"></script>
    <script src="~/Asserts/Client/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="~/Asserts/Client/js/jquery.bootstrap.wizard.js" type="text/javascript"></script>
    <script src="~/Asserts/Client/js/gsdk-bootstrap-wizard.js"></script>
    <script src="~/Asserts/Client/js/jquery.validate.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/css/select2.min.css" rel="stylesheet" />



    <script>
    var list = JSON.parse('@Html.Raw(ViewBag.userString)');
    var nameArray = [];
    var SelectedUserArray = [];

    for (let index = 0; index < list.length; index++) {
        nameArray.push(list[index].UserName);
    }
        $(document).ready(function () {
            setTimeout(function () {
                $('#AlertBox').hide('slow');
            }, 10000);
            $("#btn-tao1").prop("disabled", true);
        $(".js-example-basic-multiple").select2({
                data: nameArray
        });
        $('#enrolmentkey').on('input', function () {
            var check = $('#enrolmentkey').val();
                if (check.length < 5)
                {
                    $("#btn-tao1").prop("disabled", true);
                    console.log(check.length);
                }
                else if (check.length > 10)
                {
                    $("#btn-tao1").prop("disabled", true);
                    console.log(check.length);
                }
                else
                {
                    $("#btn-tao1").prop("disabled", false);
                    console.log(check.length);
                                $('#btn-tao1').click(function (e) {
                 e.preventDefault();
                SelectedUserArray = [];
            $('.select2-selection__choice__display').each(function () {
                SelectedUserArray.push($(this).text());
            })
            console.log(SelectedUserArray)
            //
            var class__Name = $('#className').val();
            var class__Des = $('#classDes').val();
                var enrolmentkey = $('#enrolmentkey').val();
             @{
                var sess = (Model.Common.UserLogin)Session[new Model.Common.CommonConstant().USER_SESSION];
             }
            var userid =@sess.UserID;

            console.log(class__Name)
            console.log(class__Des)
                e.preventDefault();
                $.ajax({
                    type: 'POST',
                    url: '/CreateClass/AddNewClass',
                    data: JSON.stringify({ 'SelectedUserArray': SelectedUserArray, 'className': class__Name, 'classDes': class__Des, 'enrolmentkey': enrolmentkey, 'userid': userid}),
                    traditional:true,
                    contentType: 'application/json; charset=utf-8',
                    datatype: 'json',
                    success: function (userid) {
                        location.reload(true);                        
                        //$('#AlertBox').delay(10000).slideUp(1000);
                    },
                    error: function () {
                        alert('Failed ');
                    }
                });
            })
                }
            });

        });
        let passwordInput = document.getElementById('enrolmentkey'),
            toggle = document.getElementById('btnToggle'),
            icon =  document.getElementById('eyeIcon');

        function togglePassword() {
          if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            icon.classList.add("fa-eye-slash");
          } else {
            passwordInput.type = 'password';
            icon.classList.remove("fa-eye-slash");
            //toggle.innerHTML = 'show';
          }
        }

        function checkInput() {
        }

        toggle.addEventListener('click', togglePassword, false);
        passwordInput.addEventListener('keyup', checkInput, false);
    </script>
}